<!doctype html>
<html lang="it">
  <head>
	<!-- python -m http.server --directory /tmp/ -->
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<link href="https://fonts.googleapis.com/css2?family=Lato:wght@900&display=swap" rel="stylesheet">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
	
	<!-- NO CACHE -->
	<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
	<meta http-equiv="Pragma" content="no-cache" />
	<meta http-equiv="Expires" content="0" />

	<!-- STYLE -->
	<link rel="stylesheet" type="text/css" href="/css/style.css">
	
	
    <title>Domotica</title>

  </head>
  <body>
      <!---->
      <div id="parallax-image">
          <div class="row h-100">
              <div class="col-md-12 align-self-center">
                  <h1 class="text-center">Automazioni</h1>
                  <h2 class="text-center">La tua casa SMART con Home Assistant</h2>
              </div>
          </div>
      </div>
      <div class="container">
          <h3>Scegliere/Verificare l'hardware</h3>
          <!-- CODE -->
          <p style="background-color: gainsboro">
              Per realizzare l'HUB è necessario un PC con una o due interfaccie di rete LAN ed una WiFi.<br/>
              Avere due interfaccie di rete LAN potrebbe essere utile nel caso in cui, ad esempio, si decidesse<br />
              di installare videocamere di sorveglianza via cavo ( utilizzando uno switch se necessario ).<br />
              Di seguito verrà descritta la procedura per la creazione di un HUB con due porte LAN ed una interfaccia WiFi.<br />
              Sarà necessario verificare che la scheda di rete WiFi che intendete utilizzare supporti la modalità MASTER o AP-Mode.<br />
              Se per realizzare l'HUB avete scelto di utilizzare un PC Intel NUC verificate che la scheda di rete supporti la modalità<br />
              Master o AP-Mode.<br />
              Se la modalità non è supportata dalla vostra scheda dovrete sostituirla o aggiungerne una.<br />
          </p>
          <a class="btn btn-outline-success" target="_blank" href="\ap_mode.html" role="Link">Guida Ubuntu WifiDocs/MasterMode</a>
          <hr style="color: black">
          <h2>Adattatori di rete testati:</h2>
          <ul class="list-group">
              <li class="list-group-item d-flex justify-content-between align-items-center">
                  Qualcomm Atheros AR9462 Wireless Network Adapter
                  <span class="badge badge-primary badge-pill">1</span>
              </li>
          </ul>
          <hr style="color: black">
      </div>
      <!---->
      <div id="parallax-image1">
          <div class="row h-100">
              <div class="col-md-12 align-self-center">
                  <h1 class="text-center">Home Assistant HUB</h1>
                  <h2 class="text-center">HUB totalmente indipendente per la casa SMART</h2>
              </div>
          </div>
      </div>
      <div class="container">
          <p>
              Il progetto consente di creare un Router, ed un Access Point con server DHCP ( che chiameremo HUB ) in grado di fornire
              indirizzi IP a tutti i dispostivi domotici ad esso connessi e gestirne la comunicazione con il server Home Assistant,
              anch'esso installato nello stesso PC.
          </p>
          <h2>Benfici</h2>
          <p>
              Il router non sarà più necessario ( tranne per le comunicazioni via Internet )<br />
              In caso di guasto la rete domotica sarà ugualmente in grado di funzionare<br />
              Si velocizza la comunicazione tra il server Home Assistant e i dispositivi, soprattuto se il router è già impegnato...<br />
          </p>
          <hr style="color: black">
      </div>
      <div class="container">
          <h2>Installazione ed avvio del Server Ubuntu</h2>
          <p>
              Installare Ubuntu Server scaricando l'immagine ISO da qui:<br />
              https://ubuntu.com/download/server
              VERSIONE PER PROCESSORI CON ARCHITETTURA AMD64 ( non ARM ) 64Bit<br />
              <a class="btn btn-outline-success" target="_blank" href="https://ubuntu.com/download/server/thank-you?version=18.04.4&architecture=amd64" role="Link">Scarica</a><br />
              Creare un supporto di avvio ( chiavetta USB ) utilizzando BALENAETCHER:<br />
              <a class="btn btn-outline-success" target="_blank" href="https://www.balena.io/etcher/" role="Link">Scarica</a><br />
              Durante l'installazione di Ubuntu abilitare il SERVER SSH.<br />
              Una volta insallato il software server e dopo aver riavviato il PC avrete a dispozione il terminale.<br />
              Accedere al sever facendo il login<br />
              Aggiornare la lista dei pacchetti:<br />
              sudo apt update<br />
              Aggiornare il software:<br />
              sudo apt upgrade<br />
              Installare i pacchetti necessari:<br />

              sudo apt install bridge-utils<br />
              sudo apt install wireless-tools<br />
              sudo apt install isc-dhcp-server<br />
              sudo apt install hostapd<br />
          </p>
          <hr style="color: black">
      </div>
      <div class="container">
          <h2>RIMUOVERE MODEM MANAGER</h2>
          <p>
              Il servizio Modem Manager potrebbe influire negativamente con il server Home Assistant
              inoltre ne impedisce l'installazione.<br />
              Rimuovere il servizio Modem Manager:<br />
              <br />
              sudo systemctl stop ModemManager<br />
              sudo systemctl disable ModemManager<br />
          </p>
          <hr style="color: black">
      </div>
      <div class="container">
          <h2>RIMUOVERE NETPLAN</h2>
          <p>
              Netplan è il nuovo servizio per la gestione delle interfaccie di rete e sostituisce il servizio
              Network Manager.<br />
              Rimuovere il servizio Netplan:<br />
              <br />
              sudo systemctl stop ModemManager<br />
              sudo systemctl disable ModemManager<br />
          </p>
          <hr style="color: black">
      </div>
      <div class="container">
          <h2>Opzionale - Disabilitare la gestione dell'interfaccia di rete WiFi</h2>
          <p>
              Ottenere il MAC address dell'interfaccia di rete WiFi utilizzare il comando:<br />
              <br />
              ifconfig -a<br />
              <br />
              Modificare il file /etc/NetworkManager/NetworkManager.conf:<br />
              <br />
              sudo nano /etc/NetworkManager/NetworkManager.conf<br />
          </p>
          <p style="background-color: gainsboro">
              Ottenere il MAC address dell'interfaccia di rete WiFi utilizzare il comando:<br />
              <br />
              ifconfig -a<br />
              <br />
              Modificare il file /etc/NetworkManager/NetworkManager.conf:<br />
              <br />
              sudo nano /etc/NetworkManager/NetworkManager.conf<br />
              <br />
              <br />
              [main]<br />
              plugins=ifupdown,keyfile<br />
              <br />
              [ifupdown]<br />
              managed=false<br />
              <br />
              [device]<br />
              wifi.scan-rand-mac-address=no<br />
              <br />
              [keyfile]<br />
              # Sostituire le coppie di 0 con i valori riportati da IFCONFING per l'interfaccia WiFi<br />
              unmanaged-devices=mac:00:00:00:00:00:00<br />
          </p>
            <hr style="color: black">
      </div>
      <div class="container">
          <h2>Abilitare le schede di rete</h2>
          <p>
              Hostapd potrebbe inoltre non essere in grado di creare correttamente il nuovo access point a causa dell'utilizzo
              della scheda WiFi da parte di un'altro software oppure a causa di restrizioni applicate al driver della scheda.<br />
              Maggiori dettagli in seguito...<br />
              <br />
              sudo nano /var/lib/NetworkManager/NetworkManager.state<br />
          </p>
          <p style="background-color: gainsboro">
              [main]<br />
              NetworkingEnabled=true<br />
              WirelessEnabled=true<br />
              WWANEnabled=true<br />
          </p>
        <hr style="color: black">
      </div>
      <div class="container">
          <h2>Configurare le interfacce di rete - Network Manager</h2>
          <!-- CODE -->
          <p style="background-color: gainsboro">
              sudo nano /etc/network/interfaces<br />
              <br />
              # ifupdown has been replaced by netplan(5) on this system.<br />
              # See /etc/netplan for current configuration.<br />
              # To re-enable ifupdown on this system, you can run:<br />
              # sudo apt install ifupdown<br />
              <br />
              # The loopback network interface<br />
              auto lo<br />
              iface lo inet loopback<br />
              <br />
              # L'interfaccia enp1s0 viene utilizzata per connettere l'HUB a internet attraverso il modem-router:<br />
              <br />
              allow-hotplug enp1s0<br />
              iface enp1s0 inet static<br />
              address 192.168.1.2 # Assegnare un IP statico all'interfaccia che dipende dalla vostra rete<br />
              netmask 255.255.255.0 # Lasciare invariata la maschera di sottorete ( Subnet Mask )<br />
              broadcast 192.168.1.255 # Modificare utilizzando come riferimento l'IP del vostro modem-router ( gateway ) ovvero 192.168.1.1 potrebbe essere 192.168.0.1. Deve essere 255 finale !<br />
              gateway 192.168.1.1 /# Usare l'indirizzo IP del vostro modem-router ( gateway )<br />
              # Only relevant if you make use of RESOLVCONF(8) or similar...<br />
              dns-nameservers 8.8.8.8 8.8.4.4 # Specificare i server DNS ( google o altri )<br />
              <br />
              # Definizione dell'interfaccia di rete lan enp2s0 ( opzionale ). L'interfaccia può essere utilizzata, ad esempio per il collegamento
              # di videocamere IP. Se necessario usare uno switch:<br />
              <br />
              # Abilta l'interfaccia di rete enp2s0<br />
              allow-hotplug enp2s0<br />
              # Utilizza il server DHCP per assegnare gli inidirizzi IP ai dispositvi connessi<br />
              iface enp2s0 inet dhcp<br />
              <br />
              # L'interfaccia di rete WiFi wlp3s0 servirà a realizzare l'Access Point WiFi
              <br />
              auto wlp3s0<br />
              iface wlp3s0 inet manual<br />
              wireless-mode master<br />
              wireless-essid Home_Assistant # Assegnare un nome alla vostra rete WiFi<br />
              <br />
              # Definizione del BRIDGE - br0 setup with static wan IPv4 with ISP router as gateway<br />
              auto br0<br />
              iface br0 inet static<br />
              address 192.168.2.1 # Assegnare un indirizzo IP ( gateway ) alla vostra nuova rete: Es 192.168.3.1, 192.168.4.1<br />
              network 192.168.2.0 # Assegnare un indirizzo IP uguale all'indirizzo gateway ma con 0 finale<br />
              netmask 255.255.255.0 # Lasciare invariata la maschera di sottorete ( Subnet Mask )<br />
              broadcast 192.168.2.255 # Assegnare un indirizzo IP uguale all'indirizzo gateway ma con 255 finale<br />
              bridge_ports enp2s0 wlp3s0 # Specificare le interfaccie assegnate al bridge<br />
              bridge_stp off<br />
              bridge_fd 0<br />
              bridge_maxwait 0<br />
          </p>
          <hr style="color: black">
      </div>

      <div class="container">
          <h3>Hostapd</h3>
          <!-- CODE -->
          <pre style="background-color: gainsboro">
                
            </pre>
          <hr style="color: black">
      </div>

      <!-- Optional JavaScript -->
      <!-- jQuery first, then Popper.js, then Bootstrap JS -->
      <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
      <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
  </body>
</html>